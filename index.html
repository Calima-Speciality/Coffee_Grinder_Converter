<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mahl-Klicks-Konverter – Calima Specialty Coffee</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, sans-serif; }
    .card { max-width: 720px; margin: auto; padding: 1rem; background: #fff; border-radius: .75rem; box-shadow: 0 0 8px rgba(0,0,0,.06); }
    label { display:block; margin:.5rem 0 .25rem; font-size:.9rem; color:#374151 }
    select,input { width:100%; padding:.6rem .7rem; border:1px solid #d1d5db; border-radius:.6rem; }
    .btn { width:100%; padding:.6rem .7rem; background:#111827; color:#fff; border:none; border-radius:.6rem; }
    .muted { color:#6b7280; font-size:.85rem; }
  </style>
</head>
<body class="bg-zinc-50 text-zinc-900">
  <!-- Header -->
  <header class="max-w-3xl mx-auto px-4 pt-6 pb-3 flex items-center gap-3">
    <img src="logo.jpg" alt="Calima Specialty Coffee" style="height:56px;width:56px;border-radius:9999px;object-fit:cover;">
    <div>
      <h1 class="text-2xl font-semibold leading-tight">Calima Specialty Coffee</h1>
      <p class="text-sm text-gray-600">Mahl-Klicks-Konverter</p>
    </div>
  </header>

  <!-- Converter -->
  <main class="max-w-3xl mx-auto px-4 pb-10 grid gap-6 md:grid-cols-2">
    <section class="card">
      <h2 class="text-lg font-medium mb-2">Konverter</h2>

      <label>Von Mühle</label>
      <select id="from"></select>

      <label>Zu Mühle</label>
      <select id="to"></select>

      <label>Klicks an Quelle</label>
      <input id="clicks" type="number" value="18" inputmode="decimal">

      <div class="mt-4 grid gap-2">
        <div class="rounded-xl bg-zinc-50 p-3 ring-1 ring-inset ring-zinc-200">
          <div class="muted">Geschätzte Partikel-Differenz</div>
          <div class="text-2xl font-semibold"><span id="micron">—</span> µm</div>
        </div>
        <div class="rounded-xl bg-emerald-50 p-3 ring-1 ring-inset ring-emerald-200">
          <div class="text-emerald-700 text-sm">Ziel-Einstellung</div>
          <div class="text-3xl font-bold text-emerald-900"><span id="result">—</span> Klick(s)</div>
        </div>
      </div>

      <p class="mt-3 text-xs text-zinc-500">
        Hinweis: Fertigungstoleranzen variieren. Als Ausgangspunkt nutzen und nach Geschmack/Flow feinjustieren.
        Eigene Null und µm/Klick kalibrieren.
      </p>
    </section>

    <!-- Public note + add-custom (saved locally on user’s device) -->
    <section class="card">
      <h2 class="text-lg font-medium mb-2">Neue Mühle hinzufügen</h2>
      <p class="muted mb-2">Von Nutzern hinzugefügte Mühlen werden lokal im Browser gespeichert.</p>

      <label>Name</label>
      <input id="gName" placeholder="z. B. Baratza Encore">

      <label>µm pro Klick</label>
      <input id="gStep" type="number" step="0.1" placeholder="z. B. 28">

      <label>Null-Klick</label>
      <input id="gZero" type="number" step="0.5" placeholder="z. B. 0">

      <button class="btn mt-3" id="addBtn">+ Mühle speichern</button>

      <p class="mt-3 text-xs text-zinc-500">
        Tipp: Null-Klick = Burr-Touch (oder Ihr Espresso-Null). Ein paar bekannte Brews messen, um µm/Klick zu verfeinern.
      </p>
    </section>
  </main>

  <!-- Footer -->
  <footer class="max-w-3xl mx-auto px-4 pb-10 text-center text-xs text-zinc-600">
    Für Kaffee-Enthusiasten und Profis. Kein Tracking. Daten bleiben in Ihrem Browser.<br>
    <strong>Erstellt von Calima Specialty Coffee</strong><br><br>
    Möchten Sie weitere Mühlen-Daten beisteuern? Schreiben Sie an
    <a href="mailto:calima.speciality@gmail.com" class="underline">calima.speciality@gmail.com</a>.<br>
    <em>Dies ist ein gemeinnütziges Community-Projekt – lassen Sie uns zusammenarbeiten.</em><br>
    <span class="block mt-1">
      (English) Want to contribute grinder data? Email <a href="mailto:calima.speciality@gmail.com" class="underline">calima.speciality@gmail.com</a>.
      This is a <strong>charitable community project</strong> — let’s collaborate.
    </span>
  </footer>

  <script>
    // Default grinders (approximate; calibrate your own)
    const STORAGE_KEY = "grinder-clicks-converter:v1";
    const defaults = [
      {name:"Comandante C40 (Standard)", step:30,   zero:0},
      {name:"Comandante C40 (Red Clix)", step:15,   zero:0},
      {name:"1Zpresso JX-Pro",           step:12.5, zero:0},
      {name:"Timemore Chestnut C2",      step:36,   zero:0},
      {name:"1Zpresso K-Plus",           step:22,   zero:0},
      {name:"Niche Zero",                step:50,   zero:0}
    ];

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaults.slice();
        const arr = JSON.parse(raw);
        return Array.isArray(arr) && arr.length ? arr : defaults.slice();
      } catch { return defaults.slice(); }
    }
    function save(gs){ localStorage.setItem(STORAGE_KEY, JSON.stringify(gs)); }

    let grinders = load();

    const fromEl = document.getElementById("from");
    const toEl   = document.getElementById("to");
    const clicksEl = document.getElementById("clicks");
    const micronEl = document.getElementById("micron");
    const resultEl = document.getElementById("result");

    function fillSelects(){
      [fromEl,toEl].forEach(el=>{
        el.innerHTML="";
        grinders.forEach((g,i)=>{
          const opt=document.createElement("option");
          opt.value=i; opt.textContent=g.name; el.append(opt);
        });
      });
    }

    function compute(){
      const f=grinders[fromEl.value];
      const t=grinders[toEl.value];
      const c=parseFloat(clicksEl.value);
      if(!f||!t||isNaN(c)){ micronEl.textContent="—"; resultEl.textContent="—"; return; }
      const mic=(c - f.zero) * f.step;
      micronEl.textContent=mic.toFixed(1);
      const raw = mic / t.step + t.zero;
      resultEl.textContent = Math.floor(raw); // always floor to whole clicks
    }

    fromEl.addEventListener("input", compute);
    toEl.addEventListener("input", compute);
    clicksEl.addEventListener("input", compute);

    // Add custom grinder (saved locally in the user's browser)
    document.getElementById("addBtn").addEventListener("click", ()=>{
      const name = document.getElementById("gName").value.trim();
      const step = parseFloat(document.getElementById("gStep").value);
      const zero = parseFloat(document.getElementById("gZero").value);
      if(!name || isNaN(step) || isNaN(zero)){ alert("Bitte Name, µm/Klick und Null-Klick ausfüllen."); return; }
      grinders.push({name, step, zero});
      save(grinders);
      fillSelects();
      // select new grinder as target by default
      toEl.value = String(grinders.length - 1);
      compute();
      document.getElementById("gName").value="";
      document.getElementById("gStep").value="";
      document.getElementById("gZero").value="";
    });

    fillSelects();
    compute();
  </script>
</body>
</html>
